/* HEPL RIA 2013 - Test One
 *
 * JS Document - /js/main.js
 *
 * coded by [Julien Roland]
 * started at 28/10/13
 *//* jshint boss: true, curly: true, eqeqeq: true, eqnull: true, immed: true, latedef: true, newcap: true, noarg: true, browser: true, jquery: true, noempty: true, sub: true, undef: true, unused: true, white: false */(function(e){"use strict";var t,n=new google.maps.LatLng(50,8),r=[],i=new google.maps.Marker,s="./img/framework/icon/markerBank.png",o="./img/framework/icon/markerMy.png",u,a,f,l=e(".listing"),c=e("#agence"),h=e(".listGlobal .dimension"),p=e(".showMap"),d=e(".app"),v=e(".appDistrib"),m=e(".appOne"),g=10,y=20,b=60,w=50,E=5,S=1,x=1,T=[],N,C="/cashcash/";e(function(){c.on("change",G);l.on("click",".more a",Q);h.on("click","a",X);e(".mapInteraction").on("click","a",W);e(".reload").on("click","a",P);p.on("click","a",B);v.on("click","a",j);e(".time").on("click","a",R);l.on("click","a",F);e(".back").on("click","a",A);console.log(location.pathname.replace(C,"").replace(".html",""));location.pathname!==C&&location.pathname!==C+"index.html"&&_(location.pathname.replace(C,"").replace(".html",""));window.addEventListener("popstate",O)});var k=function(){e(".loading").delay(500).fadeOut("slow");L();history.pushState({selector:".app"},"index","index.html");H()},L=function(){t=new google.maps.Map(document.getElementById("gmap"),{center:n,zoom:16,disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})},A=function(){history.back()},O=function(e){D(e.state?e.state:"index.html")},M=function(){f=a[this.id];I(f)},_=function(e){if(e==="index"){v.fadeOut("fast");m.fadeOut("fast");d.fadeIn("fast")}else if(e==="carte"){d.fadeOut("fast");m.fadeOut("fast");v.fadeIn("fast")}},D=function(t){if(t){var n=e(t.selector);if(n.selector===d.selector){v.fadeOut("fast");m.fadeOut("fast");d.fadeIn("fast")}else if(n.selector===v.selector){d.fadeOut("fast");m.fadeOut("fast");v.fadeIn("fast")}else if(n.selector===m.selector){d.fadeOut("fast");v.fadeOut("fast");m.fadeIn("fast")}}},P=function(){location.reload()},H=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(Z,tt):alert("Impossible de vous localiser !")},B=function(e){e.preventDefault();history.pushState({selector:".appDistrib"},e.target.rel,e.target.rel+".html");d.fadeOut("fast");v.fadeIn()},j=function(e){e.preventDefault();history.pushState({selector:".app"},e.target.rel,e.target.rel+".html");v.fadeOut("fast");d.fadeIn()},F=function(t){t.preventDefault();history.pushState({selector:".appOne"},e(this).attr("rel"),e(this).attr("rel").toLowerCase().split(" ").join("-")+".html");v.fadeOut("fast");d.fadeOut("fast");m.fadeIn();var n=parseFloat(e(this).attr("data-id")),r=a[n];m.find(".details").css("background-color","#"+r.bank.color);m.find("img").attr("src",r.bank.icon);m.find("h2").html(r.bank.name);m.find("h2>a").attr("href",r.bank.url);m.find("address").html(r.address);m.find(".nb").html(z(r.distance)+"'");m.find(".nb").attr("data-distance",r.distance);m.find(".distance>span").html(r.distance+"m")},I=function(e){history.pushState({selector:".appOne"},e.bank.name,"bank-"+e.bank.name.toLowerCase().split(" ").join("-")+".html");v.fadeOut("fast");d.fadeOut("fast");m.fadeIn();m.find(".details").css("background-color","#"+e.bank.color);m.find("img").attr("src",e.bank.icon);m.find("h2").html(e.bank.name);m.find("h2>a").attr("href",e.bank.url);m.find("address").html(e.address);m.find(".nb").html(z(e.distance)+"'");m.find(".nb").attr("data-distance",e.distance);m.find(".distance>span").html(e.distance+"m")},q=function(){var e=c.find("option"),t;if(e.size()>1){e.remove();for(t=0;t<=T.length-1;t++)c.append('<option value="'+T[t][0]+'">'+T[t][1]+"</option>");c.find("option:first-child").before('<option value="0">Toutes</option>')}else{for(t=0;t<=T.length-1;t++)c.append('<option value="'+T[t][0]+'">'+T[t][1]+"</option>");l.append('<li class="more"><a href="" title="Voir plus de banques"><span class="icon icon-plus-grey"></span><span>Voir plus de distributeurs</span></a></li>')}},R=function(t){t.preventDefault();var n;if(x===1){n=parseFloat(e(this).find(".nb").attr("data-distance"));m.find(".nb").html(U(n)+'"');m.find(".icon").removeClass("icon-foot");m.find(".icon").addClass("icon-car");x=2}else if(x===2){n=parseFloat(e(this).find(".nb").attr("data-distance"));m.find(".nb").html(z(n)+"'");m.find(".icon").removeClass("icon-car");m.find(".icon").addClass("icon-foot");x=1}},U=function(e){return Math.round(b*60/(w*1e3)*e)},z=function(e){return Math.round(b/E*parseFloat(e)/1e3)},W=function(e){e.preventDefault();H()},X=function(e){e.preventDefault();var t;t=l.find(".dimension");if(S===1){V(t);h.find("a").css({backgroundImage:"url(./img/framework/icon/walk.png)"})}else if(S===2){J(t);h.find("a").css({backgroundImage:"url(./img/framework/icon/bird.png)"})}else if(S===3){$(t);h.find("a").css({backgroundImage:"url(./img/framework/icon/car.png)"})}},V=function(t){t.each(function(){var t=Math.round(b*60/(w*1e3)*parseFloat(e(this).attr("data-dimension")));e(this).html(t+'"')});S=2},$=function(t){t.each(function(){var t=e(this).attr("data-dimension");e(this).html(t+"m")});S=1},J=function(t){t.each(function(){var t=Math.round(b/E*parseFloat(e(this).attr("data-dimension"))/1e3);e(this).html(t+"'")});S=3},K=function(t,n){for(var r=0;r<=g;r++)if(e.inArray(t,n[r])>=0)return!0},Q=function(t){t.preventDefault();var n=e(".more");if(g+y<=a.length){for(var r=g;r<=g+y-1;r++)if(a[r].bank){n.before('<li  data-idBank="'+a[r].bank.id+'"><a data-id="'+r+'" href="javascript:void()" rel="'+a[r].bank.name+'" title="Voir la fiche de la'+a[r].bank.name+'"><span class="overBank" style="color:white;background-color:#'+a[r].bank.color+'">Voir cette bank ('+a[r].bank.name+')</span><div class="infosBank" data-type="'+a[r].bank.color+'"><div class="logoBank"><img src="'+a[r].bank.icon+'" alt="Logo de la bank '+a[r].bank.name+'"></div><span style="color:#'+a[r].bank.color+'" class="titleBank">'+a[r].bank.name+'</span></div><div class="dimension" data-dimension="'+a[r].distance+'" style="background-color:#'+a[r].bank.color+'"><span>'+a[r].distance+"</span></div></a></li>");K(a[r].bank.id,T)||T.push([a[r].bank.id,a[r].bank.name])}q();rt();g+=y}else{n.remove();alert("Il n' a pas d'autre distributeur dans la r√©gion !")}},G=function(){var t=parseFloat(e(this).find("option:selected").val()),n=e(".listing li");if(t===0)n.slideDown();else{n.not("[data-idBank='"+t+"']").slideUp();e('.listing li[data-idBank="'+t+'"]').slideDown()}},Y=function(){var e=new google.maps.LatLng(u.latitude,u.longitude);t.panTo(e)},Z=function(e){u=e.coords;i.setMap(t);i.setPosition(new google.maps.LatLng(u.latitude,u.longitude));i.setIcon(o);Y();nt()},et=function(e,t){var n=10;return"http://ccapi.superacid.be/terminals?latitude="+e+"&longitude="+t+"&radius="+n},tt=function(e){console.log(e)},nt=function(){N=et(u.latitude,u.longitude);e.ajax({url:N,dataType:"json",type:"GET",cache:"true",success:function(e){if(e.error===!1){a=e.data;it(g);q();rt()}}})},rt=function(){for(var e=0;e<=g-1;e++){var n;n=new google.maps.Marker({position:new google.maps.LatLng(a[e].latitude,a[e].longitude),map:t,icon:s,id:e,title:"Voir le detail de la banque"});r.push(n);google.maps.event.addListener(n,"click",M)}},it=function(e){if(e+y<=a.length)for(var t=0;t<=e-1;t++)if(a[t].bank){l.append('<li  data-idBank="'+a[t].bank.id+'"><a data-id="'+t+'" rel="'+a[t].bank.name+'" href="javascript:void()" title="Voir la fiche de la'+a[t].bank.name+'"><span class="overBank" style="color:white;background-color:#'+a[t].bank.color+'">Voir cette bank ('+a[t].bank.name+')</span><div class="infosBank" data-type="'+a[t].bank.color+'"><div class="logoBank"><img src="'+a[t].bank.icon+'" alt="Logo de la bank '+a[t].bank.name+'"></div><span style="color:#'+a[t].bank.color+'" class="titleBank">'+a[t].bank.name+'</span></div><div class="dimension" data-dimension="'+a[t].distance+'" style="background-color:#'+a[t].bank.color+'"><span>'+a[t].distance+"</span></div></a></li>");K(a[t].bank.id,T)||T.push([a[t].bank.id,a[t].bank.name])}};e(window).ready(k)}).call(this,jQuery);
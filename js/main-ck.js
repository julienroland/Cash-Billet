/* HEPL RIA 2013 - Test One
 *
 * JS Document - /js/main.js
 *
 * coded by [Julien Roland]
 * started at 28/10/13
 *//* jshint boss: true, curly: true, eqeqeq: true, eqnull: true, immed: true, latedef: true, newcap: true, noarg: true, browser: true, jquery: true, noempty: true, sub: true, undef: true, unused: true, white: false */(function(e){"use strict";var t,n=new google.maps.LatLng(50,8),r=[],i={},s=new google.maps.Marker,o="./img/framework/icon/markerBank.png",u="./img/framework/icon/markerMy.png",a,f,l,c=e(".listing"),h=e("#agence"),p=e(".listGlobal .dimension"),d=e(".showMap"),v=e(".app"),m=e(".appDistrib"),g=e(".appOne"),y=10,b=20,w=60,E=50,S=5,x=1,T=1,N=[],C;e(function(){h.on("change",V);c.on("click",".more a",X);p.on("click","a",R);e(".mapInteraction").on("click","a",q);e(".reload").on("click","a",M);d.on("click","a",D);m.on("click","a",P);e(".time").on("click","a",j);c.on("click","a",H);window.addEventListener("popstate",L)});var k=function(){e(".loading").delay(500).fadeOut("slow");nt();history.pushState({selector:".app"},"index","index.html");_()},L=function(e){O(e.state?e.state:"index.html")},A=function(e){l=f[this.id];B(l)},O=function(t){if(t){var n=e(t.selector);console.log(v);if(n.selector==v.selector){console.log("app");m.fadeOut("fast");g.fadeOut("fast");v.fadeIn("fast")}else if(n.selector==m.selector){console.log("appDistrib");v.fadeOut("fast");g.fadeOut("fast");m.fadeIn("fast")}else if(n.selector==g.selector){console.log("appOne");v.fadeOut("fast");m.fadeOut("fast");g.fadeIn("fast")}}},M=function(){location.reload()},_=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition($,K):alert("Impossible de vous localiser !")},D=function(e){e.preventDefault();history.pushState({selector:".appDistrib"},e.target.rel,e.target.rel+".html");v.fadeOut("fast");m.fadeIn()},P=function(e){e.preventDefault();history.pushState({selector:".app"},e.target.rel,e.target.rel+".html");m.fadeOut("fast");v.fadeIn()},H=function(t){t.preventDefault();console.log(e(this));history.pushState({selector:".appOne"},e(this).attr("rel"),e(this).attr("rel").toLowerCase().split(" ").join("-")+".html");m.fadeOut("fast");v.fadeOut("fast");g.fadeIn();var n=parseFloat(e(this).attr("data-id")),r=f[n];g.find(".details").css("background-color","#"+r.bank.color);g.find("img").attr("src",r.bank.icon);g.find("h2").html(r.bank.name);g.find("h2>a").attr("href",r.bank.url);g.find("address").html(r.address);g.find(".nb").html(I(r.distance)+"'");g.find(".nb").attr("data-distance",r.distance);g.find(".distance>span").html(r.distance+"m")},B=function(e){history.pushState({selector:".appOne"},e.bank.name,"bank-"+e.bank.name.toLowerCase().split(" ").join("-")+".html");m.fadeOut("fast");v.fadeOut("fast");g.fadeIn();g.find(".details").css("background-color","#"+e.bank.color);g.find("img").attr("src",e.bank.icon);g.find("h2").html(e.bank.name);g.find("h2>a").attr("href",e.bank.url);g.find("address").html(e.address);g.find(".nb").html(I(e.distance)+"'");g.find(".nb").attr("data-distance",e.distance);g.find(".distance>span").html(e.distance+"m")},j=function(t){t.preventDefault();if(T===1){var n=parseFloat(e(this).find(".nb").attr("data-distance"));g.find(".nb").html(F(n)+'"');g.find(".icon").removeClass("icon-foot");g.find(".icon").addClass("icon-car");T=2}else if(T===2){var n=parseFloat(e(this).find(".nb").attr("data-distance"));g.find(".nb").html(I(n)+"'");g.find(".icon").removeClass("icon-car");g.find(".icon").addClass("icon-foot");T=1}},F=function(e){return Math.round(w*60/(E*1e3)*e)},I=function(e){return Math.round(w/S*parseFloat(e)/1e3)},q=function(e){e.preventDefault();_()},R=function(e){e.preventDefault();var t;t=c.find(".dimension");if(x===1){U(t);p.find("a").css({backgroundImage:"url(./img/framework/icon/walk.png)"})}else if(x===2){W(t);p.find("a").css({backgroundImage:"url(./img/framework/icon/bird.png)"})}else if(x===3){z(t);p.find("a").css({backgroundImage:"url(./img/framework/icon/car.png)"})}},U=function(t){t.each(function(){var t=Math.round(w*60/(E*1e3)*parseFloat(e(this).attr("data-dimension")));e(this).html(t+'"')});x=2},z=function(t){t.each(function(){var t=e(this).attr("data-dimension");e(this).html(t+"m")});x=1},W=function(t){t.each(function(){var t=Math.round(w/S*parseFloat(e(this).attr("data-dimension"))/1e3);e(this).html(t+"'")});x=3},X=function(t){t.preventDefault();var n=e(".more");if(y+b<=f.length){for(var r=y;r<=y+b-1;r++)if(f[r].bank){var i=f[r].address,s=i.replace(" ","-"),o=s.replace(",","-");n.before('<li  data-idBank="'+f[r].bank.id+'"><a data-id="'+r+'" href="javascript:void()" rel="'+f[r].bank.name+'" title="Voir la fiche de la"'+f[r].bank.name+'"><span class="overBank" style="color:white;background-color:#'+f[r].bank.color+'">Voir cette bank ('+f[r].bank.name+')</span><div class="infosBank" data-type="'+f[r].bank.color+'"><div class="logoBank"><img src="'+f[r].bank.icon+'" alt="Logo de la bank '+f[r].bank.name+'"></div><span style="color:#'+f[r].bank.color+'" class="titleBank">'+f[r].bank.name+'</span></div><div class="dimension" data-dimension="'+f[r].distance+'" style="background-color:#'+f[r].bank.color+'"><span>'+f[r].distance+"</span></div></a></li>");et(f[r].bank.id,N)||N.push([f[r].bank.id,f[r].bank.name])}Z();G();y+=b}else{n.remove();alert("Il n' a pas d'autre distributeur dans la r√©gion !")}},V=function(t){var n=parseFloat(e(this).find("option:selected").val()),r=e(".listing li");if(n===0)r.slideDown();else{r.not("[data-idBank='"+n+"']").slideUp();e('.listing li[data-idBank="'+n+'"]').slideDown()}},$=function(e){a=e.coords;s.setMap(t);s.setPosition(new google.maps.LatLng(a.latitude,a.longitude));s.setIcon(u);tt();Q()},J=function(e,t){var n=10;return"http://ccapi.superacid.be/terminals?latitude="+e+"&longitude="+t+"&radius="+n},K=function(e){console.log(e)},Q=function(){C=J(a.latitude,a.longitude);e.ajax({url:C,dataType:"json",type:"GET",cache:"true",success:function(e){console.log(e);if(e.error===!1){f=e.data;Y(y);Z();G()}}})},G=function(){for(var e=0;e<=y-1;e++){var n;n=new google.maps.Marker({position:new google.maps.LatLng(f[e].latitude,f[e].longitude),map:t,icon:o,id:e,title:"Voir le detail de la banque"});r.push(n);google.maps.event.addListener(n,"click",A)}},Y=function(e){if(e+b<=f.length)for(var t=0;t<=e-1;t++)if(f[t].bank){c.append('<li  data-idBank="'+f[t].bank.id+'"><a data-id="'+t+'" rel="'+f[t].bank.name+'" href="javascript:void()" title="Voir la fiche de la"'+f[t].bank.name+'"><span class="overBank" style="color:white;background-color:#'+f[t].bank.color+'">Voir cette bank ('+f[t].bank.name+')</span><div class="infosBank" data-type="'+f[t].bank.color+'"><div class="logoBank"><img src="'+f[t].bank.icon+'" alt="Logo de la bank '+f[t].bank.name+'"></div><span style="color:#'+f[t].bank.color+'" class="titleBank">'+f[t].bank.name+'</span></div><div class="dimension" data-dimension="'+f[t].distance+'" style="background-color:#'+f[t].bank.color+'"><span>'+f[t].distance+"</span></div></a></li>");et(f[t].bank.id,N)||N.push([f[t].bank.id,f[t].bank.name])}},Z=function(){var e=h.find("option");if(e.size()>1){e.remove();for(var t=0;t<=N.length-1;t++)h.append('<option value="'+N[t][0]+'">'+N[t][1]+"</option>");h.find("option:first-child").before('<option value="0">Toutes</option>')}else{for(var t=0;t<=N.length-1;t++)h.append('<option value="'+N[t][0]+'">'+N[t][1]+"</option>");c.append('<li class="more"><a href="" title="Voir plus de banques"><span class="icon icon-plus-grey"></span><span>Voir plus de distributeurs</span></a></li>')}},et=function(t,n){for(var r=0;r<=y;r++)if(e.inArray(t,n[r])>=0)return!0},tt=function(){var e=new google.maps.LatLng(a.latitude,a.longitude);t.panTo(e)},nt=function(){t=new google.maps.Map(document.getElementById("gmap"),{center:n,zoom:16,disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})};e(window).ready(k)}).call(this,jQuery);
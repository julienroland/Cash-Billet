/* HEPL RIA 2013 - Test One
 *
 * JS Document - /js/main.js
 *
 * coded by [Julien Roland]
 * started at 28/10/13
 *//* jshint boss: true, curly: true, eqeqeq: true, eqnull: true, immed: true, latedef: true, newcap: true, noarg: true, browser: true, jquery: true, noempty: true, sub: true, undef: true, unused: true, white: false */(function(e){"use strict";var t,n=new google.maps.LatLng(50,8),r=new google.maps.Marker,i,s,o,u=-1,a=e(".listing"),f=e("#agence"),l=e(".listGlobal .dimension"),c=10,h=20,p=[],d;e(function(){f.on("change",y);a.on("click",".more a",g);l.on("click","a",m)});var v=function(){e(".loading").delay(500).fadeOut("slow");k();navigator.geolocation&&navigator.geolocation.getCurrentPosition(b,E)},m=function(e){e.preventDefault();console.log(a.find(".dimension").text())},g=function(t){t.preventDefault();var n=e(".more");if(c+h<=s.length){for(var r=c;r<=c+h-1;r++)if(s[r].bank){n.before('<li data-id="'+s[r].bank.id+'"><a href="javascript:void()" title="Voir la fiche de la"'+s[r].bank.name+'"><span class="overBank" style="color:white;background-color:#'+s[r].bank.color+'">Voir cette bank ('+s[r].bank.name+')</span><div class="infosBank" data-type="'+s[r].bank.color+'"><div class="logoBank"><img src="'+s[r].bank.icon+'" alt="Logo de la bank '+s[r].bank.name+'"></div><span style="color:#'+s[r].bank.color+'" class="titleBank">'+s[r].bank.name+'</span></div><div class="dimension" style="background-color:#'+s[r].bank.color+'"><span>'+s[r].distance+"</span></div></a></li>");N(s[r].bank.id,p)||p.push([s[r].bank.id,s[r].bank.name])}T();c+=h}else{n.remove();alert("Il n' a pas d'autre distributeur dans la r√©gion !")}},y=function(t){var n=parseFloat(e(this).find("option:selected").val()),r=e(".listing li");if(n===0)r.slideDown();else{r.not("[data-id='"+n+"']").slideUp();e('.listing li[data-id="'+n+'"]').slideDown()}},b=function(e){i=e.coords;C();S()},w=function(e,t){var n=10;return"http://ccapi.superacid.be/terminals?latitude="+e+"&longitude="+t+"&radius="+n},E=function(e){console.log(e)},S=function(){d=w(i.latitude,i.longitude);e.ajax({url:d,dataType:"json",type:"GET",cache:"true",success:function(e){console.log(e);if(e.error===!1){s=e.data;x(c);T()}}})},x=function(e){if(e+h<=s.length)for(var t=0;t<=e-1;t++){a.append('<li data-id="'+s[t].bank.id+'"><a href="javascript:void()" title="Voir la fiche de la"'+s[t].bank.name+'"><span class="overBank" style="color:white;background-color:#'+s[t].bank.color+'">Voir cette bank ('+s[t].bank.name+')</span><div class="infosBank" data-type="'+s[t].bank.color+'"><div class="logoBank"><img src="'+s[t].bank.icon+'" alt="Logo de la bank '+s[t].bank.name+'"></div><span style="color:#'+s[t].bank.color+'" class="titleBank">'+s[t].bank.name+'</span></div><div class="dimension" style="background-color:#'+s[t].bank.color+'"><span>'+s[t].distance+"</span></div></a></li>");N(s[t].bank.id,p)||p.push([s[t].bank.id,s[t].bank.name])}},T=function(){var e=f.find("option");if(e.size()>1){e.remove();for(var t=0;t<=p.length-1;t++)f.append('<option value="'+p[t][0]+'">'+p[t][1]+"</option>");f.find("option:first-child").before('<option value="0">Toutes</option>')}else{for(var t=0;t<=p.length-1;t++)f.append('<option value="'+p[t][0]+'">'+p[t][1]+"</option>");a.append('<li class="more"><a href="" title="Voir plus de banques"><span class="icon icon-plus-grey"></span><span>Voir plus de distributeurs</span></a></li>')}},N=function(t,n){for(var r=0;r<=c;r++)if(e.inArray(t,n[r])>=0)return!0},C=function(){var e=new google.maps.LatLng(i.latitude,i.longitude);t.panTo(e)},k=function(){t=new google.maps.Map(document.getElementById("gmap"),{center:n,zoom:10,disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})};e(window).ready(v)}).call(this,jQuery);
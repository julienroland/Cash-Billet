/* HEPL RIA 2013 - Test One
 *
 * JS Document - /js/main.js
 *
 * coded by [Julien Roland]
 * started at 28/10/13
 *//* jshint boss: true, curly: true, eqeqeq: true, eqnull: true, immed: true, latedef: true, newcap: true, noarg: true, browser: true, jquery: true, noempty: true, sub: true, undef: true, unused: true, white: false */(function(t){"use strict";var n,r=new google.maps.LatLng(50,8),i=[],s={},o=new google.maps.Marker,u="./img/framework/icon/markerBank.png",a="./img/framework/icon/markerMy.png",f,l,c,h=t(".listing"),p=t("#agence"),d=t(".listGlobal .dimension"),v=t(".showMap"),m=t(".app"),g=t(".appDistrib"),y=t(".appOne"),b=10,w=20,E=60,S=50,x=5,T=1,N=1,C=[],k;t(function(){p.on("change",$);h.on("click",".more a",V);d.on("click","a",U);t(".mapInteraction").on("click","a",R);t(".reload").on("click","a",_);v.on("click","a",P);g.on("click","a",H);t(".time").on("click","a",F);h.on("click","a",B);window.addEventListener("popstate",A)});var L=function(){t(".loading").delay(500).fadeOut("slow");rt();history.pushState({selector:".app",old:".appDistrib"},"index","index.html");D()},A=function(e){M(e.state?e.state:"index.html")},O=function(e){c=l[this.id];j(c)},M=function(e){if(e){var n=t(e.selector),r=t(e.old);r.fadeOut("fast");n.fadeIn("fast")}},_=function(){location.reload()},D=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(J,Q):alert("Impossible de vous localiser !")},P=function(e){e.preventDefault();history.pushState({selector:".appDistrib",old:".app"},e.target.rel,e.target.rel+".html");m.fadeOut("fast");g.fadeIn()},H=function(e){e.preventDefault();history.pushState({selector:".app",old:".appDistrib"},e.target.rel,e.target.rel+".html");g.fadeOut("fast");m.fadeIn()},B=function(e){e.preventDefault();history.pushState({selector:".appOne",old:".app"},e.target.rel,e.target.rel+".html");g.fadeOut("fast");m.fadeOut("fast");y.fadeIn();var n=parseFloat(t(this).attr("data-id")),r=l[n];y.find(".details").css("background-color","#"+r.bank.color);y.find("img").attr("src",r.bank.icon);y.find("h2").html(r.bank.name);y.find("h2>a").attr("href",r.bank.url);y.find("address").html(r.address);y.find(".nb").html(q(r.distance)+"'");y.find(".nb").attr("data-distance",r.distance);y.find(".distance>span").html(r.distance+"m")},j=function(t){history.pushState({selector:".appOne",old:".appDistrib"},e.target.rel,e.target.rel+".html");g.fadeOut("fast");m.fadeOut("fast");y.fadeIn();y.find(".details").css("background-color","#"+t.bank.color);y.find("img").attr("src",t.bank.icon);y.find("h2").html(t.bank.name);y.find("h2>a").attr("href",t.bank.url);y.find("address").html(t.address);y.find(".nb").html(q(t.distance)+"'");y.find(".nb").attr("data-distance",t.distance);y.find(".distance>span").html(t.distance+"m")},F=function(e){e.preventDefault();if(N===1){var n=parseFloat(t(this).find(".nb").attr("data-distance"));y.find(".nb").html(I(n)+'"');y.find(".icon").removeClass("icon-foot");y.find(".icon").addClass("icon-car");N=2}else if(N===2){var n=parseFloat(t(this).find(".nb").attr("data-distance"));y.find(".nb").html(q(n)+"'");y.find(".icon").removeClass("icon-car");y.find(".icon").addClass("icon-foot");N=1}},I=function(e){return Math.round(E*60/(S*1e3)*e)},q=function(e){return Math.round(E/x*parseFloat(e)/1e3)},R=function(e){e.preventDefault();D()},U=function(e){e.preventDefault();var t;t=h.find(".dimension");if(T===1){z(t);d.find("a").css({backgroundImage:"url(./img/framework/icon/walk.png)"})}else if(T===2){X(t);d.find("a").css({backgroundImage:"url(./img/framework/icon/bird.png)"})}else if(T===3){W(t);d.find("a").css({backgroundImage:"url(./img/framework/icon/car.png)"})}},z=function(e){e.each(function(){var e=Math.round(E*60/(S*1e3)*parseFloat(t(this).attr("data-dimension")));t(this).html(e+'"')});T=2},W=function(e){e.each(function(){var e=t(this).attr("data-dimension");t(this).html(e+"m")});T=1},X=function(e){e.each(function(){var e=Math.round(E/x*parseFloat(t(this).attr("data-dimension"))/1e3);t(this).html(e+"'")});T=3},V=function(e){e.preventDefault();var n=t(".more");if(b+w<=l.length){for(var r=b;r<=b+w-1;r++)if(l[r].bank){var i=l[r].address,s=i.replace(" ","-"),o=s.replace(",","-");n.before('<li  data-idBank="'+l[r].bank.id+'"><a data-id="'+r+'" href="javascript:void()" rel="'+l[r].bank.name+'" title="Voir la fiche de la"'+l[r].bank.name+'"><span class="overBank" style="color:white;background-color:#'+l[r].bank.color+'">Voir cette bank ('+l[r].bank.name+')</span><div class="infosBank" data-type="'+l[r].bank.color+'"><div class="logoBank"><img src="'+l[r].bank.icon+'" alt="Logo de la bank '+l[r].bank.name+'"></div><span style="color:#'+l[r].bank.color+'" class="titleBank">'+l[r].bank.name+'</span></div><div class="dimension" data-dimension="'+l[r].distance+'" style="background-color:#'+l[r].bank.color+'"><span>'+l[r].distance+"</span></div></a></li>");tt(l[r].bank.id,C)||C.push([l[r].bank.id,l[r].bank.name])}et();Y();b+=w}else{n.remove();alert("Il n' a pas d'autre distributeur dans la r√©gion !")}},$=function(e){var n=parseFloat(t(this).find("option:selected").val()),r=t(".listing li");if(n===0)r.slideDown();else{r.not("[data-idBank='"+n+"']").slideUp();t('.listing li[data-idBank="'+n+'"]').slideDown()}},J=function(e){f=e.coords;o.setMap(n);o.setPosition(new google.maps.LatLng(f.latitude,f.longitude));o.setIcon(a);nt();G()},K=function(e,t){var n=10;return"http://ccapi.superacid.be/terminals?latitude="+e+"&longitude="+t+"&radius="+n},Q=function(e){console.log(e)},G=function(){k=K(f.latitude,f.longitude);t.ajax({url:k,dataType:"json",type:"GET",cache:"true",success:function(e){console.log(e);if(e.error===!1){l=e.data;Z(b);et();Y()}}})},Y=function(){for(var e=0;e<=b-1;e++){var t;t=new google.maps.Marker({position:new google.maps.LatLng(l[e].latitude,l[e].longitude),map:n,icon:u,id:e,title:"Voir le detail de la banque"});i.push(t);google.maps.event.addListener(t,"click",O)}},Z=function(e){if(e+w<=l.length)for(var t=0;t<=e-1;t++)if(l[t].bank){h.append('<li  data-idBank="'+l[t].bank.id+'"><a data-id="'+t+'" rel="'+l[t].bank.name+'" href="javascript:void()" title="Voir la fiche de la"'+l[t].bank.name+'"><span class="overBank" style="color:white;background-color:#'+l[t].bank.color+'">Voir cette bank ('+l[t].bank.name+')</span><div class="infosBank" data-type="'+l[t].bank.color+'"><div class="logoBank"><img src="'+l[t].bank.icon+'" alt="Logo de la bank '+l[t].bank.name+'"></div><span style="color:#'+l[t].bank.color+'" class="titleBank">'+l[t].bank.name+'</span></div><div class="dimension" data-dimension="'+l[t].distance+'" style="background-color:#'+l[t].bank.color+'"><span>'+l[t].distance+"</span></div></a></li>");tt(l[t].bank.id,C)||C.push([l[t].bank.id,l[t].bank.name])}},et=function(){var e=p.find("option");if(e.size()>1){e.remove();for(var t=0;t<=C.length-1;t++)p.append('<option value="'+C[t][0]+'">'+C[t][1]+"</option>");p.find("option:first-child").before('<option value="0">Toutes</option>')}else{for(var t=0;t<=C.length-1;t++)p.append('<option value="'+C[t][0]+'">'+C[t][1]+"</option>");h.append('<li class="more"><a href="" title="Voir plus de banques"><span class="icon icon-plus-grey"></span><span>Voir plus de distributeurs</span></a></li>')}},tt=function(e,n){for(var r=0;r<=b;r++)if(t.inArray(e,n[r])>=0)return!0},nt=function(){var e=new google.maps.LatLng(f.latitude,f.longitude);n.panTo(e)},rt=function(){n=new google.maps.Map(document.getElementById("gmap"),{center:r,zoom:16,disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP})};t(window).ready(L)}).call(this,jQuery);